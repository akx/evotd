(function(){function yn(e,t){function n(){}n[a]=(e.superclass=t)[a];(e[a]=new n).constructor=e;typeof t.extended==Ct&&t.extended(e);return e}function bn(e,t){return function(){return e[t].apply(e,arguments)}}var e="attributes",t="strokeStyle",n="beginPath",r="actual",i="fillStyle",s="initialize",o=!1,u="displayName",a="prototype",f="length",l=null,c="lineWidth",h="push",p="damageBlip",d="acquiredEnemy",v=!0,m="white",g="health",y="gridY",b="random",w="towerTray",E="gridX",S="setGridCoords",x="addEventListener",T="stroke",N="ammoSpeed",C="generation",k="fillText",L="checkGridObj",A="evolve",O="ammoDamage",M="shotInterval",_="updateGridCoordsFromXY",D="maxRange",P="maxHealth",H="credits",B="nextReload",j="isPlaceable",F="enemiesLeft",I="figureOutNextSpawn",q="ammoRange",R="nextAcquisition",U="towerMutationRate",z="towers",W="lineTo",X="nextShot",V="moveTo",$="nextSpawn",J="silver",K="onStage",Q="_process",G="heart",Y="slowingAmmo",Z="creeps",et="reloading",tt="homingAmmo",nt="maxAmmo",rt="magenta",it="getAstarNeighbors",st="acqInterval",ot="ammoDeceleration",ut="restore",at="actualSpeed",ft="target",lt="hsl(",ct="gameOver",ht="damage",pt="ljParams",dt="enemyMutationRate",vt="reloadTime",mt="actualSize",gt="route",yt="depletionTime",bt="tower-hurt",wt="totalEnemiesLeft",Et="unacquire",St="reroute",xt="translate",Tt="shoot",Nt="red",Ct="function",kt="enemiesSpawned",Lt="core-hit",At="ammo-hit",Ot="dead",Mt="blocking",_t="createBoulder",Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn;Dt=function(e,t){var n,r=[];t==l&&(t=8);for(n=0;n<t;++n)r[h](!!(e&1<<n));return r};Pt=function(e){var t,n,r,i;t=0;for(n=0,r=e[f];n<r;++n){i=e[n];i&&(t|=1<<n)}return t};Ht=function(e,t,n){return t*n+e*(1-n)};Bt=function(e,t){return(e+Math[b]()*(t-e))*(Math[b]()<.5?-1:1)};jt=function(e,t){return e+Math[b]()*(t-e)};Ft=function(e,t){return 0|e+Math[b]()*(t-e)};It=function(e){return e[Ft(0,e[f])]};qt=function(e,t,n){var r,i;r=e.x-t.x;i=e.y-t.y;return r*r+i*i<n*n};Rt=function(e,t,n){var r,i,s,o,u,a,f,l=[];r=Math.cos(t*n.wd);i=Math.sin(t*n.zd);s=n.R-n.r;for(o=0;o<25;o+=.1){u=s/n.r*o;a=s*Math.cos(o)+n.d*Math.cos(r+u);f=s*Math.sin(o)-n.d*Math.sin(i-u);o==0?l[h](e[V](a,f)):l[h](e[W](a,f))}return l};Ut=function(){return{R:15+Math[b]()*15,r:5+Math[b]()*10,d:Math[b]()*5,wd:Bt(1.1,1.4),zd:Bt(1.1,1.4)}};zt="Corbel, Segoe UI, Frutiger Linotype, sans-serif";Wt=function(e,t){return{x:e,y:t,id:e+","+t}};Xt=function(e,t,n){function x(e,t){return a[e.id]-a[t.id]}var r,i,s,o,u,a,c,p,d,v,m,g,y,b,w,E,S;r={};i=[];s={};o={};u={};a={};c=function(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)};p=function(e,t){var n,r;n=e.x-t.x;r=e.y-t.y;return Math.sqrt(n*n+r*r)};d=function(e,t){i[h](e);s[e.id]=1;u[e.id]=t};v=function(e){a[e.id]=u[e.id]+c(e,t)};m=function(){var e,n,r;e=t;n=[];while(r=o[e.id]){n.unshift(r);e=r}return n};d(e,0);v(e);while(i[f]){i=i.sort(x);g=i.shift();delete s[g.id];if(g.id==t.id)return m();r[g.id]=1;for(y=0,w=(b=n(g))[f];y<w;++y){E=b[y];if(r[E.id])continue;S=u[g.id]+p(g,E);if(!s[E.id]||S<u[E.id]){d(E,S);o[E.id]=g;a[E.id]=u[E.id]+c(E,t)}}}return l};Vt={};$t=v;Jt=function(e,t){var n;n=new Audio;n.setAttribute("src",t);n.load();return Vt[e]=n};Kt=function(e){var t;if(!$t)return;t=Vt[e];return t.play()};Qt=function(){function n(){}n[u]="Gene";var e=n[a],t=n;e[s]=function(){};e[A]=function(e,t,n){n==l&&(n=0)};return n}();Gt=function(e){function r(){}r[u]="EightBitGene";var t=yn(r,e)[a],n=r;t[s]=function(){return Math[b]()};t[A]=function(e,t,n){var r,i,s,o,u,a;n==l&&(n=0);r=eightBits(e*255);i=eightBits(t*255);s=[];for(o=0;o<8;++o){u=Math[b]()<.5;Math[b]()<n?s[h](u):u?s[h](r[o]):s[h](i[o])}a=s;return Pt(a)/256};return r}(Qt);Yt=function(e){function r(){}r[u]="FloatGene";var t=yn(r,e)[a],n=r;t[s]=function(){return Math[b]()};t[A]=function(e,t,n){n==l&&(n=0);return Math[b]()<n?this[s]():Ht(e,t,jt(.3,.7))};return r}(Qt);Zt=function(){function r(e){this.genes=e}r[u]="Genome";var t=r[a],n=r;t[s]=function(){var e,t,n,r;e={};for(t in n=this.genes){r=n[t];e[t]=r[s]()}return e};t[A]=function(t,n,r){var i,o,u,a,f,c,h;r==l&&(r=0);t=t[e]||t;n=n[e]||n;i={};for(o in u=this.genes){a=u[o];f=t[o];c=n[o];f!==undefined&&c!==undefined?h=a[A](f,c,r):h=a[s]();i[o]=h}return i};return r}();en=function(){function n(){this[E]=this[y]=this.x=this.y=0}n[u]="GridObject";var e=n[a],t=n;e[S]=function(e,t){this.x=(this[E]=0|e)*32+16;this.y=(this[y]=0|t)*32+16};e[_]=function(){this[E]=0|this.x/32;this[y]=0|this.y/32};return n}();tn=function(s){function b(t){var n;this[e]=t;s.call(this);this[B]=0;this[X]=0;this[R]=0;this[g]=this[P]=5;this[p]=o;this[C]=0;this[r]={maxAmmo:0|Ht(1,50,this[e].reloadAmmo),shotInterval:1/Ht(3,20,this[e].shootSpeed),acqInterval:Ht(4,.3,this[e].acquisitionSpeed),maxRange:0|Ht(48,200,this[e][D]),reloadTime:Ht(1,5,this[e].reloadSpeed),ammoDamage:Ht(1,35,this[e][O]),ammoSpeed:Ht(3,20,this[e][N]),ammoRange:Ht(80,400,this[e][q]),ammoDeceleration:this[e][ot],slowingAmmo:this[e][Y]>.75,homingAmmo:this[e][tt]>.85};this[r].dps=this[r][O]/(1/this[r][M]);this[yt]=this[r][nt]*this[r][M]+.1;this.reload();n=0|this[e].hue*360;this[i]=lt+n+",100%,50%)"}b[u]="Tower";var c=yn(b,s)[a],y=b;c.reload=function(){this.ammo=this[r][nt];this[X]=0;this[B]=0;return this[et]=o};c.beginReload=function(){this[et]=v;return this[B]=pn+this[yt]+this[r][vt]};c.reacquire=function(){var e,t,n,i,s,o,u,a,c,h;this[Et]();e=l;t=0;n=this[r][D]*this[r][D];for(i=0,o=(s=hn[Z])[f];i<o;++i){u=s[i];a=this.x-u.x;c=this.y-u.y;h=a*a+c*c;if((!e||h<t)&&h<n){t=h;e=u}}this[d]=e;return this[X]=pn+this[r][M]};c[Et]=function(){this[d]=l;this[R]=pn+this[r][st]};c.step=function(){this[K]=v;pn>=this[R]&&this.reacquire();this.ammo<=0&&(this[B]<=0?this.beginReload():pn>=this[B]&&this.reload());if(this[d]){if(!qt(this,this[d],this[r][D]))return this[Et]();if(this.ammo>0&&pn>=this[X]){this[X]=pn+this[r][M];if(this[d][Ot])return this[d]=l;this[Tt](this[d]);return this.ammo--}}};c[Tt]=function(e){var t;t=new un(this.x,this.y,this[i],this[r],e);hn.ammo[h](t);return Kt(Tt)};c.draw=function(s){var u,a,f,l,c,h,v,g;u=8+this[e].height*48;a=3+this[e].baseWidth*27;f=3+this[e].topWidth*17;s.font="12px "+zt;s[t]="transparent";for(l=0;l<u;l+=3){c=1-l/u;c=Math.pow(c,this[e].form*2);h=Ht(f,a,c);v=Ht(this[e].hue*360,this[e].hueTop*360,c);s[i]=this[p]?m:lt+v+", 100%, 50%)";s[n]();s.arc(0,-l,h/2,0,6.282);s.fill()}this[p]=o;if(this[K]){if(this.ammo>0){s[n]();g=Ht(0,32,this.ammo/this[r][nt]);s.rect(-16,14,g,2);s.fill()}s[i]=m;if(this[et]&&pn*2&1){s[n]();s[k]("R",-2,0)}if(!this[et]&&!this[d]){s[n]();s[k]("?",-2,0)}}};c[ht]=function(){this[g]--;this[p]=v;Kt(bt);if(this[g]<=0)return this[Ot]=v};return b}(en);nn=function(e){function o(){e.call(this);this[pt]=Ut();this[I](5);this.pool=[gn[s](),gn[s](),gn[s](),gn[s](),gn[s]()];this[F]=this.enemiesTotal=300;this[kt]=0}o[u]="Spawner";var r=yn(o,e)[a],i=o;r[I]=function(e){var t;e==l&&(e=1);t=jt(.75,4)*e;return this[$]=pn+t};r.draw=function(e){var r;e.save();e.rotate(pn);e[n]();e[t]=Nt;e[c]=1;Rt(e,pn,this[pt]);e[T]();e[ut]();if(this[$]>0){r=Math.min(1,(this[$]-pn)/5);e[t]=m;e[n]();e[c]=1;e.arc(0,0,8+Math.cos(pn)*4,0,Ht(0,6.282,r));e[T]()}};r.step=function(){if(!hn[ct]&&this[F]&&this[$]&&pn>=this[$]){this[I]();this.spawn()}};r.spawn=function(){var e,t,n;this[F]--;this[kt]++;e=[].concat(this.pool).concat(hn[Z]);e[f]&&Math[b]()>.95?t=gn[A](It(e),It(e),hn[dt]):t=gn[s]();n=new on(t);n.spawner=this;n[S](this[E],this[y]);n[St]();hn[Z][h](n)};return o}(en);rn=function(e){function s(){e.call(this);this[pt]=Ut();this[g]=this[P]=50;this[p]=0}s[u]="Heart";var r=yn(s,e)[a],i=s;r[ht]=function(){this[g]--;this[p]=15;Kt(Lt)};r.draw=function(e){e[t]="lime";this.life<this.maxLife*.5&&pn*3%1<.5&&(e[t]="orange");if(this[p]>0){this[p]--;pn*5%1<.5&&(e[t]=m)}e.save();e.rotate(-pn);e[n]();e[c]=1;Rt(e,pn,this[pt]);e[T]();e[ut]();if(this.life<this.maxLife){e[t]=m;e.save();e.rotate(pn*3);e[n]();e[c]=1;e.arc(0,0,8+Math.cos(pn)*2,0,Ht(0,6.282,this.life/this.maxLife));e[T]();e[ut]()}};return s}(en);sn=function(e){function o(){e.call(this);this[Mt]=v}o[u]="Boulder";var r=yn(o,e)[a],s=o;r.draw=function(e){e[n]();e[i]="#444";e[t]=J;e[c]=2;e.rect(-12,-12,24,24);e.fill();e[T]();e[n]();e[i]="#666";e.rect(-12,-24,24,24);e.fill();e[T]()};return o}(en);on=function(r){function w(t){this[e]=t;r.call(this);this[gt]=l;this[at]=Ht(2,12,this[e].speed)*Math.sqrt(this[e][g]);this[mt]=Ht(6,32,this[e].size)/2;this[P]=this[g]=0|Ht(30,500,this[e][g]);this.dx=this.dy=0}w[u]="Enemy";var s=yn(w,r)[a],d=w;s.draw=function(r){var s,u,a,f;s=0|this[e].hue*360;u=(this[e].hue-.5)*pn*(1+this[e].speed)*10;a=lt+s+", 30%, 50%)";r[n]();if(this[p]){a=m;this[p]=o}r[i]=r[t]=a;r[c]=this.rage&&pn*3%1<.5?6:2;r.arc(0,0,this[mt],u,u+4.7);r[T]();if(this[g]>0&&this[g]<this[P]){r[n]();f=Ht(0,32,this[g]/this[P]);r.rect(-16,14,f,2);r.fill()}};s.step=function(){var t,n,r,i,s,u,a,l,c,p,d;t=this.lastTime||pn;n=pn-t;if(this[gt]&&this[gt][f]){r=this[gt][0];this.rage=o}else{r={worldX:hn[G].x,worldY:hn[G].y};this.rage=v;Math[b]()<.1&&this[St]()}if(r){i=r.worldX-this.x;s=r.worldY-this.y;u=i*i+s*s;if(u<25)this[gt].shift();else{a=Math.atan2(s,i);l=Math.min(Math.sqrt(u),this[at])*(this.rage?3:1);c=Math.cos(a)*l;p=Math.sin(a)*l;this.dx=Ht(this.dx,c,.5);this.dy=Ht(this.dy,p,.5)}}this.x+=this.dx;this.y+=this.dy;this[_]();this.rage&&(d=hn[L](hn[z],this[E],this[y]))&&d[ht]();if(this[E]==hn[G][E]&&this[y]==hn[G][y]){this[Ot]=v;hn[G][ht]();this.spawner.pool[h](this[e])}this.lastTime=pn};s[St]=function(){var e,t,n,r,i,s;this[_]();e=Wt(this[E],this[y]);t=Wt(hn[G][E],hn[G][y]);n=Xt(e,t,bn(hn,it));if(!n){console.log("COULD NOT FIND ROUTE",e,t);this[gt]=l;return}n[h](t);for(r=0,i=n[f];r<i;++r){s=n[r];s.worldX=s.x*32+Ft(4,28);s.worldY=s.y*32+Ft(4,28)}this[gt]=n};s[ht]=function(e){var t;if(this[g]<=0)return;this[g]-=e;this[p]=v;if(this[g]<=0){t=2|Math.ceil(this[P]/75);hn[H]+=t;this[Ot]=v;return Kt("kill")}return Kt(At)};return w}(en);un=function(r){function l(t,n,r,s,o){var u,a,f;this.x=t;this.y=n;this[i]=r;this[e]=s;this[ft]=o;u=Math.atan2(this[ft].y-this.y,this[ft].x-this.x);this.dx=Math.cos(u)*this[e][N];this.dy=Math.sin(u)*this[e][N];this.initialX=this.x;this.initialY=this.y;a=this[e][q];this.rangeSq=a*a;f=this[e][N]*Math.max(1,Math.sqrt(this[e][O]*.25));this.size=Math.max(2,Math.min(7,f))*.6;this.decel=Ht(1,.95,this[e][ot]);this.life=200}l[u]="Shot";var s=yn(l,r)[a],o=l;s.step=function(){var t,n,r,i,s,o,u,a,l,c,h,p,d;this.x+=this.dx;this.y+=this.dy;this.dx*=this.decel;this.dy*=this.decel;if(this[e][tt]&&!this[ft][Ot]){t=Math.atan2(this[ft].y-this.y,this[ft].x-this.x);this.dx=Ht(Math.cos(t)*this[e][N],this.dx,.2);this.dy=Ht(Math.sin(t)*this[e][N],this.dy,.2)}if(!(this.life--)||Math.abs(this.dx+this.dy)<.1)this[Ot]=v;n=0|this.x/32;r=0|this.y/32;i=this.x-this.initialX;s=this.y-this.initialY;i*i+s*s>=this.rangeSq&&(this[Ot]=v);for(o=0,a=(u=hn[Z])[f];o<a;++o){l=u[o];if(l[y]!=r)continue;c=this.x-l.x;h=this.y-l.y;p=Math.max(4,l[mt]);if(c*c+h*h<p*p){l[ht](this[e][O]);this[e][Y]&&(l[at]*=.95);this[Ot]=v;break}}for(o=0,a=(u=hn.objs)[f];o<a;++o){d=u[o];if(d[Mt]&&n==d[E]&&r==d[y]){this[Ot]=v;break}}};s.draw=function(r){r[n]();r[c]=1;r[t]=m;r[i]=this[i];r.save();r.rotate(pn*this[e][N]);r.rect(-this.size,-this.size,this.size*2,this.size*2);r.fill();r[T]();r[ut]()};return l}(en);an=function(){function p(){this[z]=[];this[Z]=[];this.ammo=[];this[w]=[];this.objs=[];this[dt]=.09;this[U]=.04;this[G]=l;this[H]=0;this[ct]=o}p[u]="World";var r=p[a],i=p;r[it]=function(e){var t,n,r,i,s;t=[];for(n=-1;n<=1;++n)for(r=-1;r<=1;++r){if(n==0&&r==0)continue;i=e.x+n;s=e.y+r;this.isRoutable(i,s)&&t[h](Wt(i,s))}return t};r[L]=function(e,t,n,r){var i,s,u;r==l&&(r=o);for(i=0,s=e[f];i<s;++i){u=e[i];if(r&&!u[Mt])continue;if(u[E]==t&&u[y]==n)return u}return o};r.isRoutable=function(e,t){return fn(e,t)?this[L](this[z],e,t)?o:this[L](this.objs,e,t,v)?o:v:o};r[j]=function(e,t){return fn(e,t)?this[L](this[z],e,t)?o:this[L](this.objs,e,t)?o:v:o};r.placeTower=function(e,t,n){var r,i,s,o,u,a,l=[];for(r=0,i=this[w][f];r<i;++r)if(this[w][r]==e){this[w].splice(r,1);break}e[S](t,n);this[z][h](e);Kt("place");for(s=0,u=(o=this[Z])[f];s<u;++s){a=o[s];l[h](a[St]())}return l};r[Q]=function(e){var t,n;t=0;while(t<e[f]){n=e[t];typeof n.step==Ct&&n.step();if(n.x<0||n.y<0||n.x>800||n.y>544)n[Ot]=v;if(n[Ot]){e.splice(t,1);continue}t+=1}return e};r.draw=function(e){var r,i,s,o,u,a,l,p,d=[];r=[].concat(this[Q](this[Z]),this[Q](this[z]),this[Q](this.objs),this[Q](this.ammo));this[G][g]<=0&&(this[ct]=v);r.sort(function(e,t){return e.y-t.y});for(i=0,s=r[f];i<s;++i){o=r[i];e[xt](o.x,o.y);o.draw(e);e[xt](-o.x,-o.y);if(dn.routes){u=o[gt];e[c]=1;e[t]="rgba(255,0,0,0.6)";if(u){e[n]();e[V](o.x,o.y);for(a=0,l=u[f];a<l;++a){p=u[a];e[W](p.worldX,p.worldY)}d[h](e[T]())}}}return d};r[_t]=function(){var e,t,n,r;e=new sn;for(t=0;t<30;++t){n=Ft(3,ln-3);r=Ft(0,cn-1);if(this[j](n,r)){e[S](n,r);this.objs[h](e);return e}}};r.newGame=function(){var e,t,n,r;this[H]=15;for(e=0;e<7;++e)this[w][h](new tn(vn[s]()));t=new nn;t[S](0,0|Math[b]()*cn-1);this.objs[h](t);this[G]=n=new rn;n[S](ln-1,0|Math[b]()*cn-1);this.objs[h](n);for(r=0;r<10;++r)this[_t]()};r.sellTower=function(e){var t,n,r,i;for(t=0,r=(n=this[z])[f];t<r;++t){i=n[t];if(e==i){e[K]=o;this[z].splice(t,1);this[H]+=3;Kt("sell");break}}};r.cloneTower=function(t){var n;Kt("clone");n=new tn(vn[A](t[e],t[e],this[U]));this[w][h](n);n[C]=t[C];this[H]-=10};r[wt]=function(){var e,t,n,r,i;e=0;for(t=0,r=(n=this.objs)[f];t<r;++t){i=n[t];i[F]&&(e+=i[F])}return e};return p}();fn=function(e,t){return e>=0&&e<ln&&t>=0&&t<cn};ln=25;cn=17;hn=l;pn=0;dn={routes:o};vn=new Zt({height:new Yt,baseWidth:new Yt,topWidth:new Yt,form:new Yt,range:new Yt,hue:new Yt,hueTop:new Yt,ammoSpeed:new Yt,ammoDamage:new Yt,ammoRange:new Yt,ammoDeceleration:new Yt,shootSpeed:new Yt,reloadAmmo:new Yt,reloadSpeed:new Yt,acquisitionSpeed:new Yt,maxRange:new Yt,slowingAmmo:new Yt,homingAmmo:new Yt});mn={maxAmmo:"Ammo/reload",shotInterval:"Shot Speed",acqInterval:"Acquisition Speed",maxRange:"Acquisition Range",reloadTime:"Reload Time",ammoDamage:"Ammo Damage",ammoSpeed:"Ammo Speed",ammoRange:"Ammo Range",ammoDeceleration:"Ammo Deceleration",dps:"DPS"};gn=new Zt({speed:new Yt,health:new Yt,hue:new Yt,size:new Yt,flying:new Yt});(function(s,u){var a,p,d,b,S,L,_,P,B,F,I,R,X,$,Q,Z,et,it;a=l;p=l;d={b:o,x:0,y:0,down:{}};b=l;S=l;L=l;_=l;P=function(e){L=e+""};B=function(){var e,r;p[n]();p[t]="purple";p[c]=1;for(e=0;e<800;e+=32){p[V](e+.5,0);p[W](e+.5,544)}for(r=0;r<544;r+=32){p[V](0,r+.5);p[W](800,r+.5)}return p[T]()};F=function(){var i,s,u,a,g,x,N,k,L,O,M;if(b&&fn(d[E],d[y])){i=hn[j](d[E],d[y]);p[n]();p[t]=i?m:Nt;p[c]=2;p.rect(d[E]*32,d[y]*32,32,32);p[T]();i&&P("Place tower")}S&&!S[K]&&(S=l);s=o;u=v;if(hn[w][f]>=10){u=o;a="Too many towers in tray"}if(hn[H]<5){u=o;a="Not enough credits"}g=l;if(!b)for(x=0,k=(N=hn[z])[f];x<k;++x){L=N[x];if(S==L||L[E]==d[E]&&L[y]==d[y]){_=L;if(S&&S!=L)if(u){g=L;p[t]=rt;P("Evolve towers (5 CR)");p[c]=1;p[n]();for(O=0;O<3;++O){p[V](L.x+jt(-5,5),L.y+jt(-5,5));p[W](S.x+jt(-5,5),S.y+jt(-5,5))}p[T]()}else{p[t]=Nt;P("Can't evolve: "+a)}p[n]();p[t]=S==L?rt:"purple";p[c]=4;p.rect(L[E]*32,L[y]*32,32,32);p[T]();if(d.b)if(u&&S&&S!=L){Kt(A);M=new tn(vn[A](S[e],L[e],hn[U]));M[C]=Math.max(S[C],L[C])+1;hn[H]-=5;hn[w][h](M);S=l;b=M}else{S=L;s=v}}}g&&(_=g);if(S){p[t]=J;p[c]=1;p[n]();p.arc(S.x,S.y,S[r][D],0,6.282);p[T]();p[t]="gray";p[n]();p.arc(S.x,S.y,S[r][q],0,6.282);p[T]()}return hn.draw(p)};I=function(){var e,r,s,o,u,a;p[t]="cyan";p[c]=1;p[n]();p[V](0,544);p[W](800,544);p[V](800,0);p[W](800,600);p[T]();p[n]();p[i]=J;p.font="14px "+zt;e=hn[wt]();if(hn[ct]){p[i]=Nt;p[k]("GAME OVER.",820,530)}else if(e<=0){p[i]="lime";p[k]("YOU WIN!",820,530)}p[k]("Credits: "+hn[H],820,550);p[k]("Core Health: "+hn[G][g],820,570);p[k]("Enemies Left: "+e,820,590);hn[w][f]==0&&p[k]("Click on two towers to evolve them!",16,570);if(hn[z][f]==0){p[i]=pn*4%1<.5?J:m;p[k]("Click on a tower below to place it.",16,530)}for(r=0,o=(s=hn[w])[f];r<o;++r){u=s[r];p.save();a=16+r*32;p[xt](a,585);if(d.x>=a-16&&d.x<a+16&&d.y>544||b==u){b!=u&&P("Select tower to place");if(d.b){b=u;S=l}p[n]();p[t]=u==b?m:rt;p.rect(-15,-15,30,30);p[T]();_=u}u.draw(p);p[ut]()}};R=function(){var e,t,s,o,u,a,l,c,d;p.font="14px "+zt;p[n]();p[i]=m;e=20;t=[];t[h]("Generation "+_[C]);for(s in o=_[r]){u=o[s];if(s=mn[s]){a=u==(0|u)?u+"":u.toFixed(2);t[h](s+": "+a)}}t[h]("");_[r][nt]<10&&t[h]("Low ammo");_[r][vt]>5&&t[h]("Slow reload");_[r][D]<50&&t[h]("Low range of acquisition");_[r][st]>3&&t[h]("Slow acquisition");_[r][q]<120&&t[h]("Low-range ammo");_[r][O]<12&&t[h]("Low damage ammo");_[r][M]<.1&&t[h]("Rapid fire");_[r][N]>12&&t[h]("Fast ammo");_[r][O]>30&&t[h]("High ammo damage");_[r][D]>150&&t[h]("Long range of acquisition");_[r][q]>250&&t[h]("Long-range ammo");_[r][st]<2&&t[h]("Fast acquisition");_[r][vt]<2&&t[h]("Fast reload");_[r][Y]&&t[h]("Ammo slows enemies");_[r][tt]&&t[h]("Ammo homes on enemies");if(_[K]){t[h]("");t[h]("[S] Sell tower (+3 CR)");hn[H]>=10&&t[h]("[C] Clone tower (-10 CR)")}for(l=0,c=t[f];l<c;++l){d=t[l];p[k](d,815,e);e+=20}};X=function(){var e,r,s;p[i]="#000";p.fillRect(0,0,1024,600);L=l;_=l;F();p[i]="#000";p.fillRect(800,0,224,600);I();_&&R();if(L){p.font="12px "+zt;e=p.measureText(L).width;r=d.x+10;r+e+5>800&&(r=d.x-10-e);s=Math.min(580,d.y-5);r+=.5;s+=.5;p[i]="rgba(0,0,0,0.5)";p[t]=m;p[c]=1;p[n]();p.rect(r,s,e+6,16);p.fill();p[T]();p[n]();p[i]=m;p[k](L,r+2,s+12)}};$=function(){var e,t;e=d[E];t=d[y];if(b&&fn(e,t)){b&&hn[j](e,t)&&hn.placeTower(b,e,t);b=l}S&&fn(e,t)&&hn[j](e,t)&&(S=l)};Q=function(e){e==115&&_&&_[K]&&hn.sellTower(_);if(e==99&&_&&hn[H]>=10&&hn[w][f]<10)return hn.cloneTower(_)};Z=function(){pn+=1/22;return X()};et=function(){hn=new an;return hn.newGame()};it=function(){var e,t;e=function(e){return s.getElementById(e)};a=e("canvas");p=a.getContext("2d");t=function(e,t){var n,r;e.x=t.offsetX||t.clientX;e.y=t.offsetY||t.clientY;n=0|e.x/32;r=0|e.y/32;if(fn(n,r)){e[E]=n;return e[y]=r}return e[E]=e[y]=-1};a[x]("mousedown",function(e){d.b=v;t(d,e);t(d.down,e)},o);a[x]("mouseup",function(e){d.b=o;t(d,e)},o);a[x]("mousemove",function(e){t(d,e)},o);a[x]("click",function(e){t(d,e);$()},o);s[x]("keypress",function(e){Q(e.keyCode||e.charCode)},o);Jt(Lt,"core-hit2.wav");Jt(At,"ammo-hit.wav");Jt("kill","kill.wav");Jt(bt,"tower-hurt.wav");Jt("place","place.wav");Jt(Tt,"shoot.wav");Jt(A,"evolve.wav");Jt("clone","clone.wav");Jt("sell","sell.wav");et();return setInterval(Z,1e3/22)};u.EvoTD={init:it,debug:dn,newGame:et,getWorld:function(){return hn},setSounds:function(e){return $t=!!e}}}).call(this,document,window)}).call(this);